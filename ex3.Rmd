---
title: "ex3"
output: html_document
date: "2023-05-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(reshape2)
library(plotly)
library(caret)
library(readr)
library(ggplot2)
library(tidyr)
library(forcats)
library(partykit)
library(randomForest)
library(pdp)
library(ggpubr)
```

# Exercise 5.- Model-agnostic: Partial Dependency Plot (PDP).


## 3.- PDP to explain the price of a house.

EXERCISE:
Apply the previous concepts to predict the price of a house from the database kc_house_data.csv. In this case, use again a random forest approximation for the prediction based on the features bedrooms, bathrooms, sqft_living, sqft_lot, floors and yr_built. 

```{r}
house <- read.csv2("kc_house_data.csv", header = TRUE,  sep = ",")

set.seed(40)

house$price <- as.numeric(house$price)
house$bedrooms <- as.numeric(house$bedrooms)
house$bathrooms <- as.numeric(house$bathrooms)
house$sqft_living <- as.numeric(house$sqft_living)
house$sqft_lot <- as.numeric(house$sqft_lot)
house$floors <- as.numeric(house$floors)
house$yr_built <- as.numeric(house$yr_built)

rf <- randomForest(data = house, price ~ bedrooms + bathrooms + sqft_living +
                    sqft_lot + floors + yr_built, ntrees = 500)



```


```{r}
set.seed(40)


subset_house <- house[sample(nrow(house), 100), ]

par(mfrow = c(2, 2))

partialPlot(rf, pred.data = subset_house,
                 x.var = c("bedrooms"), plot = TRUE) +
                    ylab("Predicted price")



partialPlot(rf, pred.data = subset_house,
                  x.var = c("bathrooms"), plot = TRUE) +
                    ylab("Predicted price")


partialPlot(rf, pred.data = subset_house,
                 x.var = c("sqft_living"), plot = TRUE) +
                    ylab("Predicted price")


partialPlot(rf, pred.data = subset_house,
                    x.var = c("floors"), plot = TRUE) +
                    ylab("Predicted price")
```

QUESTION:
Analyse the influence of bedrooms, bathrooms, sqft_living and floors on the predicted price.


